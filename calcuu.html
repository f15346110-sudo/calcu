<!DOCTYPE html>
<html>
<head>
  <title>Kalkulator Matematika</title>
  <style>
     body {
        margin: 0;
        padding: 0;
        font-family: Consolas, monospace;
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        animation: slideShow 15s infinite, zoomEffect 20s infinite alternate;
        color: #fff;
        overflow-x: hidden;
     }

     @keyframes slideShow {
        0%   { background-image: url('mtk1.jpg'); }
        33%  { background-image: url('mtk2.jpg'); }
        66%  { background-image: url('mtk3.jpg'); }
        100% { background-image: url('mtk1.jpg'); }
     }

     @keyframes zoomEffect {
        0% { background-size: 100% 100%; }
        50% { background-size: 110% 110%; }
        100% { background-size: 100% 100%; }
     }

     @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
     }

     @keyframes glow {
        0% { box-shadow: 0 0 5px #5ab4f8; }
        50% { box-shadow: 0 0 20px #5ab4f8, 0 0 30px #5ab4f8; }
        100% { box-shadow: 0 0 5px #5ab4f8; }
     }

     .calculator {
        width: 360px;
        margin: 100px auto 20px auto;
        border: 2px solid #5ab4f8;
        border-radius: 12px;
        padding: 15px;
        background: rgba(10, 15, 30, 0.9); 
        box-shadow: 0 0 20px #5ab4f8;
        text-align: center;
        animation: glow 3s infinite alternate;
        transition: transform 0.3s ease;
     }

     .calculator:hover {
        transform: translateY(-5px);
     }

     .display-container {
        position: relative;
        margin-bottom: 15px;
     }

     .display {
        width: 95%;
        height: 50px;
        text-align: right;
        padding: 10px;
        font-size: 22px;
        font-weight: bold;
        border: none;
        border-radius: 8px;
        background: #111;
        color: #5ab4f8;
        box-shadow: inset 0 0 10px #5ab4f8;
        transition: all 0.3s ease;
     }

     .display:focus {
        outline: none;
        box-shadow: inset 0 0 15px #5ab4f8, 0 0 10px #5ab4f8;
     }

     #conversion {
        text-align: right;
        font-size: 14px;
        margin-bottom: 15px;
        font-weight: bold;
        color: #9cf;
        min-height: 20px;
        transition: all 0.5s ease;
     }

     .buttons {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-gap: 8px;
     }

     .button {
        padding: 14px;
        text-align: center;
        font-size: 14px;
        cursor: pointer;
        background-color: #1c1f2b;
        border: 2px solid #5ab4f8;
        border-radius: 8px;
        color: #5ab4f8;
        transition: all 0.2s ease;
        font-weight: bold;
        position: relative;
        overflow: hidden;
     }

     .button:before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(90, 180, 248, 0.5);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
     }

     .button:hover:before {
        width: 300px;
        height: 300px;
     }

     .button:hover {
        background-color: #5ab4f8;
        color: black;
        box-shadow: 0 0 15px #5ab4f8;
        transform: translateY(-3px);
     }

     .button:active {
        transform: scale(0.95);
        background-color: #3498db;
        color: black;
     }

     .button span {
        display: block;
        font-size: 14px;
        color: #a3d8ff;
     }

     .history {
        width: 360px;
        margin: 10px auto;
        background: rgba(10, 15, 30, 0.9);
        border: 2px solid #5ab4f8;
        border-radius: 8px;
        padding: 10px;
        max-height: 200px;
        overflow-y: auto;
        font-size: 14px;
        color: #9cf;
        box-shadow: 0 0 15px #5ab4f8;
        transition: all 0.3s ease;
     }

     .history:hover {
        box-shadow: 0 0 25px #5ab4f8;
     }

     .history h3 {
        margin-top: 0;
        font-size: 16px;
        text-align: center;
        color: #5ab4f8;
        padding-bottom: 8px;
        border-bottom: 1px dashed #5ab4f8;
     }

     .history p {
        margin: 5px 0;
        border-bottom: 1px dashed #5ab4f8;
        padding-bottom: 3px;
        transition: all 0.3s ease;
     }

     .history p:hover {
        background-color: rgba(90, 180, 248, 0.1);
        padding-left: 5px;
     }

     .clear-history {
        margin-top: 10px;
        padding: 8px;
        background-color: #1c1f2b;
        border: 1px solid #5ab4f8;
        border-radius: 5px;
        color: #5ab4f8;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: bold;
     }

     .clear-history:hover {
        background-color: #5ab4f8;
        color: black;
     }

     .audio-controls {
        position: fixed;
        bottom: 20px;
        right: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        z-index: 100;
     }

     .audio-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(10, 15, 30, 0.8);
        border: 2px solid #5ab4f8;
        color: #5ab4f8;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
     }

     .audio-btn:hover {
        background: #5ab4f8;
        color: black;
        transform: scale(1.1);
     }

     .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(10, 15, 30, 0.9);
        border: 2px solid #5ab4f8;
        border-radius: 8px;
        padding: 15px;
        color: #5ab4f8;
        box-shadow: 0 0 15px #5ab4f8;
        transform: translateX(150%);
        transition: transform 0.5s ease;
        z-index: 100;
        max-width: 300px;
     }

     .notification.show {
        transform: translateX(0);
     }

     .notification h4 {
        margin: 0 0 10px 0;
        color: #5ab4f8;
     }

     .notification p {
        margin: 0;
        font-size: 14px;
     }

     .voice-controls {
        position: fixed;
        top: 20px;
        left: 20px;
        background: rgba(10, 15, 30, 0.9);
        border: 2px solid #5ab4f8;
        border-radius: 8px;
        padding: 10px;
        z-index: 100;
     }

     .voice-controls h3 {
        margin: 0 0 10px 0;
        color: #5ab4f8;
        font-size: 16px;
        text-align: center;
     }

     .voice-btn {
        padding: 8px 15px;
        background: #1c1f2b;
        border: 1px solid #5ab4f8;
        border-radius: 5px;
        color: #5ab4f8;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: bold;
        margin: 5px;
        display: inline-block;
     }

     .voice-btn:hover {
        background: #5ab4f8;
        color: black;
     }

     .voice-btn.active {
        background: #5ab4f8;
        color: black;
     }

     @media (max-width: 768px) {
        .calculator, .history {
            width: 90%;
        }
        
        .audio-controls {
            bottom: 10px;
            right: 10px;
        }
        
        .voice-controls {
            top: 10px;
            left: 10px;
            right: 10px;
        }
     }
  </style>
</head>
<body>
  <audio id="musik" autoplay loop>
    <source src="pica2.mp3" type="audio/mpeg">
  </audio>

  <audio id="bipSound">
    <source src="uiclick.mp3" type="audio/mpeg">
  </audio>

  <audio id="siuSound">
    <source src="siu.mp3" type="audio/mpeg">
  </audio>

  <div class="notification" id="notification">
    <h4>Kalkulator Siap!</h4>
    <p>Klik tombol suara untuk mengaktifkan voice assistant</p>
  </div>

  <div class="voice-controls">
    <h3>Kontrol Suara</h3>
    <div>
      <button class="voice-btn" id="voiceBtn" onclick="toggleVoice()">ðŸ”Š Aktifkan Suara</button>
    </div>
  </div>

  <div class="calculator">
    <div class="display-container">
      <input type="text" class="display" id="display" disabled>
    </div>
    <div id="conversion"></div>
    <div class="buttons">
      <div class="button" onclick="appendToDisplay('7','tujuh')"><span>7</span>tujuh</div>
      <div class="button" onclick="appendToDisplay('8','delapan')"><span>8</span>delapan</div>
      <div class="button" onclick="appendToDisplay('9','sembilan')"><span>9</span>sembilan</div>
      <div class="button" onclick="appendToDisplay('/','bagi')">Ã·</div>
      <div class="button" onclick="appendToDisplay('4','empat')"><span>4</span>empat</div>
      <div class="button" onclick="appendToDisplay('5','lima')"><span>5</span>lima</div>
      <div class="button" onclick="appendToDisplay('6','enam')"><span>6</span>enam</div>
      <div class="button" onclick="appendToDisplay('*','kali')">Ã—</div>
      <div class="button" onclick="appendToDisplay('1','satu')"><span>1</span>satu</div>
      <div class="button" onclick="appendToDisplay('2','dua')"><span>2</span>dua</div>
      <div class="button" onclick="appendToDisplay('3','tiga')"><span>3</span>tiga</div>
      <div class="button" onclick="appendToDisplay('-','kurang')">-</div>
      <div class="button" onclick="appendToDisplay('0','nol')"><span>0</span>nol</div>
      <div class="button" onclick="appendToDisplay('.','koma')">,</div>
      <div class="button" onclick="calculate()">=</div>
      <div class="button" onclick="appendToDisplay('+','tambah')">+</div>
      <div class="button" onclick="clearDisplay()" style="grid-column: span 4;">Hapus</div>
    </div>
  </div>

  <div class="history" id="historyBox">
    <h3>Riwayat Perhitungan</h3>
    <div id="historyList"></div>
    <button class="clear-history" onclick="clearHistory()">Hapus Riwayat</button>
  </div>

  <div class="audio-controls">
    <div class="audio-btn" onclick="toggleMusic()" id="musicToggle">ðŸ”Š</div>
    <div class="audio-btn" onclick="toggleSound()" id="soundToggle">ðŸ”Š</div>
  </div>

  <script>
    // Inisialisasi variabel global
    const display = document.getElementById('display');
    const bipSound = document.getElementById('bipSound');
    const historyList = document.getElementById('historyList');
    const conversion = document.getElementById('conversion');
    const kursUSD = 15500;
    const siuSound = document.getElementById("siuSound");
    const musik = document.getElementById("musik");
    const notification = document.getElementById('notification');
    const voiceBtn = document.getElementById('voiceBtn');
    
    // Variabel untuk kontrol audio
    let musicEnabled = true;
    let soundEnabled = true;
    let voiceEnabled = false;
    let firstInteraction = true;
    let speechSynthesisSupported = false;
    
    // Cek dukungan browser untuk Speech Synthesis
    if ('speechSynthesis' in window) {
        speechSynthesisSupported = true;
    } else {
        console.warn("Browser tidak mendukung Speech Synthesis");
    }
    
    // Fungsi untuk menampilkan notifikasi
    function showNotification(title, message) {
        notification.querySelector('h4').textContent = title;
        notification.querySelector('p').textContent = message;
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }
    
    // Fungsi untuk text-to-speech
    function speak(text) {
        if (!voiceEnabled || !speechSynthesisSupported) return;
        
        try {
            // Hentikan semua ucapan yang sedang berjalan
            window.speechSynthesis.cancel();
            
            let utter = new SpeechSynthesisUtterance(text);
            utter.lang = "id-ID"; 
            utter.rate = 1.1;
            utter.pitch = 1;
            utter.volume = 1;
            
            // Tambahkan event listener untuk debugging
            utter.onstart = function() {
                console.log("Speech synthesis started:", text);
            };
            
            utter.onend = function() {
                console.log("Speech synthesis ended");
            };
            
            utter.onerror = function(event) {
                console.error("Speech synthesis error:", event.error);
            };
            
            window.speechSynthesis.speak(utter);
        } catch (e) {
            console.error("Speech synthesis error:", e);
        }
    }
    
    // Fungsi untuk memainkan suara klik
    function playClickSound() {
        if (!soundEnabled) return;
        
        try {
            bipSound.pause();
            bipSound.currentTime = 0;
            bipSound.play().catch(e => console.log("Audio play error:", e));
        } catch (e) {
            console.error("Sound play error:", e);
        }
    }
    
    // Fungsi untuk memformat angka
    function formatNumber(num) {
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }
    
    // Fungsi untuk menambahkan angka/operator ke display
    function appendToDisplay(value, voiceText) {
        // Handle first interaction untuk memulai musik
        if (firstInteraction) {
            firstInteraction = false;
            try {
                musik.play().catch(e => {
                    console.log("Autoplay prevented, waiting for interaction");
                    showNotification("Info", "Klik tombol play untuk memulai musik");
                });
                showNotification("Kalkulator Siap!", "Musik telah diaktifkan. Selamat menghitung!");
            } catch (e) {
                console.error("Music play error:", e);
            }
        }
        
        display.value += value;
        formatDisplay();
        playClickSound();
        
        // Ucapkan teks jika voice diaktifkan
        if(voiceText && voiceEnabled) {
            speak(voiceText);
        }
        
        // Animasi pulse untuk tombol yang ditekan
        event.target.style.animation = "pulse 0.3s";
        setTimeout(() => {
            event.target.style.animation = "";
        }, 300);
    }
    
    // Fungsi untuk memformat display
    function formatDisplay() {
        let raw = display.value.replace(/\./g, "");
        if (!isNaN(raw)) {
            display.value = formatNumber(raw);
        }
    }
    
    // Fungsi untuk menghapus display
    function clearDisplay() {
        display.value = '';
        conversion.innerHTML = '';
        speak("hapus");
        
        // Animasi untuk display
        display.style.animation = "pulse 0.5s";
        setTimeout(() => {
            display.style.animation = "";
        }, 500);
    }
    
    // Fungsi untuk menghitung hasil
    function calculate() {
        try {
            let expression = display.value.replace(/\./g, ""); 
            let result = eval(expression); 
            display.value = formatNumber(result);
            
            // Konversi ke USD
            let usd = (result / kursUSD).toFixed(2);
            conversion.innerHTML = `ðŸ’µ ${formatNumber(result)} IDR = $${usd} USD`;
            
            // Animasi untuk konversi
            conversion.style.animation = "pulse 0.5s";
            setTimeout(() => {
                conversion.style.animation = "";
            }, 500);
            
            // Tambahkan ke riwayat
            addHistory(`${expression} = ${result}`);
            
            // Ucapkan hasil
            if (voiceEnabled) {
                speak("hasil " + result);
            }
            
            // Mainkan suara siu
            if (soundEnabled) {
                try {
                    siuSound.pause();
                    siuSound.currentTime = 0;
                    siuSound.play().catch(e => console.log("Siu sound error:", e));
                } catch (e) {
                    console.error("Siu sound error:", e);
                }
            }
            
            // Animasi untuk display
            display.style.animation = "pulse 0.5s";
            setTimeout(() => {
                display.style.animation = "";
            }, 500);
            
        } catch (error) {
            display.value = "Error";
            conversion.innerHTML = "";
            speak("error");
            
            // Animasi untuk display error
            display.style.animation = "pulse 0.5s";
            display.style.color = "#ff5555";
            setTimeout(() => {
                display.style.animation = "";
                display.style.color = "#5ab4f8";
            }, 500);
        }
    }
    
    // Fungsi untuk menambahkan riwayat perhitungan
    function addHistory(text) {
        let p = document.createElement("p");
        p.textContent = text;
        historyList.prepend(p);
        
        // Animasi untuk riwayat baru
        p.style.animation = "pulse 0.5s";
        setTimeout(() => {
            p.style.animation = "";
        }, 500);
        
        // Batasi riwayat maksimal 10 item
        while (historyList.children.length > 10) {
            historyList.removeChild(historyList.lastChild);
        }
    }
    
    // Fungsi untuk menghapus riwayat
    function clearHistory() {
        historyList.innerHTML = '';
        speak("riwayat dihapus");
        showNotification("Riwayat Dihapus", "Semua riwayat perhitungan telah dihapus");
    }
    
    // Fungsi untuk toggle musik
    function toggleMusic() {
        musicEnabled = !musicEnabled;
        const musicToggle = document.getElementById('musicToggle');
        
        if (musicEnabled) {
            musik.play().catch(e => console.log("Music play error:", e));
            musicToggle.textContent = "ðŸ”Š";
            showNotification("Musik Aktif", "Musik latar telah diaktifkan");
        } else {
            musik.pause();
            musicToggle.textContent = "ðŸ”‡";
            showNotification("Musik Nonaktif", "Musik latar telah dinonaktifkan");
        }
    }
    
    // Fungsi untuk toggle suara efek
    function toggleSound() {
        soundEnabled = !soundEnabled;
        const soundToggle = document.getElementById('soundToggle');
        
        if (soundEnabled) {
            soundToggle.textContent = "ðŸ”Š";
            showNotification("Suara Efek Aktif", "Efek suara telah diaktifkan");
        } else {
            soundToggle.textContent = "ðŸ”‡";
            showNotification("Suara Efek Nonaktif", "Efek suara telah dinonaktifkan");
        }
    }
    
    // Fungsi untuk toggle suara AI
    function toggleVoice() {
        if (!speechSynthesisSupported) {
            showNotification("Tidak Didukung", "Browser Anda tidak mendukung fitur suara AI");
            return;
        }
        
        voiceEnabled = !voiceEnabled;
        
        if (voiceEnabled) {
            voiceBtn.textContent = "ðŸ”‡ Nonaktifkan Suara";
            voiceBtn.classList.add("active");
            showNotification("Suara AI Aktif", "Voice assistant telah diaktifkan");
            
            // Ucapkan pesan selamat datang
            setTimeout(() => {
                speak("Halo, saya siap membantu anda menghitung");
            }, 500);
        } else {
            voiceBtn.textContent = "ðŸ”Š Aktifkan Suara";
            voiceBtn.classList.remove("active");
            showNotification("Suara AI Nonaktif", "Voice assistant telah dinonaktifkan");
            
            // Hentikan semua ucapan yang sedang berjalan
            window.speechSynthesis.cancel();
        }
    }
    
    // Fungsi untuk menangani input keyboard
    document.addEventListener('keydown', function(event) {
        const key = event.key;
        
        // Angka
        if (key >= '0' && key <= '9') {
            appendToDisplay(key, getNumberVoiceText(key));
        }
        // Operator
        else if (key === '+') {
            appendToDisplay('+', 'tambah');
        }
        else if (key === '-') {
            appendToDisplay('-', 'kurang');
        }
        else if (key === '*') {
            appendToDisplay('*', 'kali');
        }
        else if (key === '/') {
            event.preventDefault(); // Mencegah pencarian
            appendToDisplay('/', 'bagi');
        }
        // Enter atau =
        else if (key === 'Enter' || key === '=') {
            calculate();
        }
        // Escape atau Delete
        else if (key === 'Escape' || key === 'Delete') {
            clearDisplay();
        }
        // Backspace
        else if (key === 'Backspace') {
            display.value = display.value.slice(0, -1);
            formatDisplay();
            playClickSound();
        }
        // Koma
        else if (key === '.') {
            appendToDisplay('.', 'koma');
        }
    });
    
    // Fungsi untuk mendapatkan teks suara dari angka
    function getNumberVoiceText(num) {
        const numberTexts = {
            '0': 'nol',
            '1': 'satu',
            '2': 'dua',
            '3': 'tiga',
            '4': 'empat',
            '5': 'lima',
            '6': 'enam',
            '7': 'tujuh',
            '8': 'delapan',
            '9': 'sembilan'
        };
        
        return numberTexts[num] || num;
    }
    
    // Inisialisasi kalkulator
    window.onload = function() {
        // Tampilkan notifikasi selamat datang
        setTimeout(() => {
            showNotification("Selamat Datang!", "Kalkulator siap digunakan. Tekan tombol untuk memulai.");
        }, 1000);
        
        // Coba autoplay musik
        try {
            const playPromise = musik.play();
            
            if (playPromise !== undefined) {
                playPromise.then(_ => {
                    // Autoplay berhasil
                    showNotification("Musik Aktif", "Musik latar telah diaktifkan");
                })
                .catch(error => {
                    // Autoplay dicegah
                    console.log("Autoplay prevented:", error);
                    showNotification("Info", "Klik tombol untuk mengaktifkan musik");
                });
            }
        } catch (e) {
            console.error("Music init error:", e);
        }
    };
  </script>
</body>
</html>
